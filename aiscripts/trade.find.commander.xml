<?xml version="1.0" encoding="utf-8"?>

<diff xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="aiscripts-diff.xsd">
    <add sel="//aiscript/init" pos="prepend">
        <set_value name="$commander" exact="this.assignedcontrolled.commander" />
        <set_value name="$reactive_default_option" exact="'$default_resupply_reactive'"/>
        <include_interrupt_actions ref="IsReactiveDockingActive"/>
        <remove_value name="$reactive_default_option" />
    </add>

    <add sel='//aiscript/attention/actions/run_script[@name="&apos;move.idle&apos;"]' pos="before">
        <do_if value="@$reactive_active">
            <do_if value="@this.ship.dock.container != this.assignedcontrolled.commander">
                <debug_text text="'docking at resupply ship'" chance="$debugchance" />
                <create_order object="this.ship" id="'DockAt'" immediate="true">
                    <param name="destination" value="this.assignedcontrolled.commander"/>
                    <param name="dockfollowers" value="true"/>
                    <param name="internalorder" value="true"/>
                    <param name="callerid" value="this.ship.order"/>
                    <param name="debugchance" value="$debugchance"/>
                </create_order>
            </do_if>
            <wait time="30s" />
            <resume label="start" />
        </do_if>
    </add>
</diff>